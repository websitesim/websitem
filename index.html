<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SakÄ±z FalÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            margin: 0;
            padding: 15px;
        }

        /* Modern Bulutlar */
        .cloud {
            position: absolute; background: #fff; border-radius: 50px; opacity: 0.6;
            animation: moveClouds linear infinite; z-index: 1; filter: blur(3px);
        }
        .cloud1 { width: 100px; height: 30px; top: 10%; left: -120px; animation-duration: 35s; }
        .cloud2 { width: 140px; height: 40px; top: 40%; right: -150px; animation-duration: 45s; direction: reverse; }

        @keyframes moveClouds {
            from { transform: translateX(-100px); }
            to { transform: translateX(calc(100vw + 200px)); }
        }

        /* Modern Kart YapÄ±sÄ± */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            width: 100%;
            max-width: 400px;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* Estetik Balonlar */
        .bday-balloon {
            position: fixed; bottom: -100px; width: 45px; height: 55px;
            border-radius: 50% 50% 50% 50% / 45% 45% 55% 55%;
            z-index: 5; animation: flyUp linear forwards;
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1);
        }
        .bday-balloon::after {
            content: ""; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            border-left: 5px solid transparent; border-right: 5px solid transparent; border-bottom: 7px solid currentColor;
        }
        @keyframes flyUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-120vh) rotate(20deg); opacity: 0; }
        }

        /* Kayma Sorunu Ä°Ã§in Fix */
        .whitespace-pre-line { word-wrap: break-word; overflow-wrap: break-word; }
        
        button { active: scale-95; transition: all 0.2s; }
    </style>
</head>
<body>

    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>

    <div id="bday-ui" style="display: none; z-index: 1000;">
        <div style="position: fixed; top: 15px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 350px; background: white; border-radius: 20px; padding: 15px; text-align: center; box-shadow: 0 15px 30px rgba(0,0,0,0.15); border: 2px solid #f472b6;">
            <h3 class="text-pink-600 font-bold text-sm">Ä°yi Ki DoÄŸdun Biricik HemÅŸirem! ðŸŽ‚</h3>
            <button id="play-music" class="mt-2 bg-pink-500 text-white text-xs px-4 py-2 rounded-full font-bold">â–¶ MÃ¼ziÄŸi BaÅŸlat</button>
            <audio id="bday-audio" loop><source src="istanbul.mp3" type="audio/mpeg"></audio>
        </div>
        <div id="balloon-container" style="pointer-events: none;"></div>
    </div>

    <h1 class="text-3xl font-extrabold text-teal-600 mb-6 z-10 tracking-tight">SunanÄ±n FallarÄ±</h1>

    <div id="login-screen" class="card space-y-4">
        <input type="text" id="username" placeholder="Ä°sminizi yazÄ±n..." class="w-full p-4 border-2 border-teal-100 rounded-2xl focus:border-teal-400 outline-none transition">
        <button onclick="login()" class="w-full bg-teal-500 text-white font-bold py-4 rounded-2xl shadow-lg shadow-teal-200">GiriÅŸ Yap</button>
    </div>

    <div id="main-screen" class="card hidden">
        <div class="flex justify-between items-center mb-6">
            <span id="user-display" class="font-bold text-teal-700"></span>
            <button onclick="logout()" class="text-xs text-gray-400">Ã‡Ä±kÄ±ÅŸ Yap</button>
        </div>

        <button onclick="drawFortune()" id="draw-btn" class="w-full bg-gradient-to-r from-pink-500 to-rose-500 text-white font-bold py-5 rounded-2xl shadow-xl mb-4 text-xl">Fal Ã‡ek âœ¨</button>
        
        <div id="current-fortune" class="p-4 bg-amber-50 border-l-4 border-amber-400 rounded-r-xl italic text-gray-700 mb-8 hidden animate-pulse">
            FalÄ±nÄ±z aÃ§Ä±lÄ±yor...
        </div>

        <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <span class="bg-teal-100 p-1 rounded-md mr-2">ðŸ“œ</span> Fal AkÄ±ÅŸÄ±
        </h2>

        <div id="fortune-list" class="space-y-4 max-height-[400px] overflow-y-auto pr-2">
            </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCQ8ZJdTmdIxGjzcxoc08w7hl0SfAyekH8",
            authDomain: "skzfli.firebaseapp.com",
            projectId: "skzfli",
            storageBucket: "skzfli.firebasestorage.app",
            messagingSenderId: "748486506131",
            appId: "1:748486506131:web:1dbcd53a4ba00f74eb7f66"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const appId = "skzfli";
        let currentUser = localStorage.getItem('userName');

        // DoÄŸum GÃ¼nÃ¼ KontrolÃ¼
        const today = new Date();
        const isBday = (today.getMonth() === 11 && today.getDate() === 31) || (today.getMonth() === 0 && today.getDate() <= 26);

        if (isBday) {
            document.getElementById('bday-ui').style.display = 'block';
            startBalloons();
            document.getElementById('play-music').onclick = function() {
                const audio = document.getElementById('bday-audio');
                if(audio.paused) { audio.play(); this.innerText = "â¸ Durdur"; }
                else { audio.pause(); this.innerText = "â–¶ MÃ¼ziÄŸi BaÅŸlat"; }
            };
        }

        function startBalloons() {
            const container = document.getElementById('balloon-container');
            setInterval(() => {
                const b = document.createElement('div');
                b.className = 'bday-balloon';
                const colors = ['#fb7185', '#60a5fa', '#34d399', '#fbbf24', '#a78bfa'];
                const color = colors[Math.floor(Math.random()*colors.length)];
                b.style.left = Math.random() * 90 + 'vw';
                b.style.backgroundColor = color;
                b.style.color = color;
                b.style.animationDuration = (5 + Math.random() * 5) + 's';
                container.appendChild(b);
                setTimeout(() => b.remove(), 10000);
            }, 800);
        }

        window.login = () => {
            const name = document.getElementById('username').value.trim();
            if(name) {
                localStorage.setItem('userName', name);
                location.reload();
            }
        };

        window.logout = () => {
            localStorage.removeItem('userName');
            location.reload();
        };

        if(currentUser) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            document.getElementById('user-display').innerText = `Selam, ${currentUser} ðŸ‘‹`;
            loadFortunes();
        }

        const fortuneTexts = [
            "Seni senden Ã§ok sever\nÄ°ste dÃ¼nyayÄ± ayaÄŸÄ±na serer",
            "AÅŸkta olmaz gurur\nO sana sen ona mecbur",
            "Duy ÅŸu Ã§arpan kalbin sesini\nSanki sÃ¶yler senin ismini"
        ];

        window.drawFortune = async () => {
            const btn = document.getElementById('draw-btn');
            const box = document.getElementById('current-fortune');
            btn.disabled = true;
            box.classList.remove('hidden');
            
            setTimeout(async () => {
                const text = fortuneTexts[Math.floor(Math.random()*fortuneTexts.length)];
                box.innerText = text;
                box.classList.remove('animate-pulse');
                await addDoc(collection(db, `artifacts/${appId}/public/data/fortunes`), {
                    text, userName: currentUser, timestamp: Date.now(), likes: []
                });
                btn.disabled = false;
            }, 1200);
        };

        function loadFortunes() {
            const q = query(collection(db, `artifacts/${appId}/public/data/fortunes`), orderBy('timestamp', 'desc'));
            onSnapshot(q, (snapshot) => {
                const list = document.getElementById('fortune-list');
                list.innerHTML = '';

                // --- Ã–ZEL DOÄžUM GÃœNÃœ FALLARI (SABÄ°T) ---
                if(isBday) {
                    const specials = [
                        { h: "HanÄ±mefendim ðŸ‘‘", t: "MumlarÄ± Ã¼fle dikkat et\nYaÅŸ soranÄ± engelle geÃ§\nBugÃ¼n doÄŸum gÃ¼nÃ¼n\nTÃ¼m nazlarÄ±n serbest", c: "border-pink-200 bg-pink-50" },
                        { h: "BiriciÄŸim ðŸŒ¸", t: "PastanÄ±n mumu yanÄ±yor\nYeni yaÅŸ sana yakÄ±ÅŸÄ±yor\nGÃ¼lÃ¼ÅŸÃ¼n ortalÄ±ÄŸÄ± Ä±sÄ±tÄ±yor\nBugÃ¼n herkes seni konuÅŸuyor", c: "border-blue-200 bg-blue-50" },
                        { h: "GÃ¶kyÃ¼zÃ¼m âœ¨", t: "Pasta kesildi mum sÃ¶ndÃ¼\nGÃ¼lÃ¼ÅŸÃ¼n gÃ¶nlÃ¼mÃ¼ndÃ¼\nDoÄŸum gÃ¼nÃ¼n bahaneydi\nGÃ¶zlerim sana dÃ¶ndÃ¼", c: "border-teal-200 bg-teal-50" }
                    ];
                    specials.forEach(s => {
                        list.innerHTML += `
                            <div class="p-4 border-2 ${s.c} rounded-2xl relative shadow-sm">
                                <span class="absolute -top-3 left-4 bg-white px-2 text-[10px] font-bold text-gray-500 uppercase tracking-widest">${s.h}</span>
                                <p class="text-sm italic text-gray-700 whitespace-pre-line font-medium">${s.t}</p>
                            </div>
                        `;
                    });
                    list.innerHTML += `<div class="text-center text-[10px] text-gray-400 font-bold tracking-tighter py-2">âœ¦ GENEL AKIÅž âœ¦</div>`;
                }

                snapshot.forEach(d => {
                    const data = d.data();
                    const isLiked = data.likes?.includes(currentUser);
                    const item = document.createElement('div');
                    item.className = "p-4 bg-white border border-gray-100 rounded-2xl shadow-sm";
                    item.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs font-bold text-teal-600">${data.userName}</span>
                            <span class="text-[9px] text-gray-400">${new Date(data.timestamp).toLocaleTimeString('tr-TR')}</span>
                        </div>
                        <p class="text-sm text-gray-600 italic mb-3 whitespace-pre-line">${data.text}</p>
                        <button onclick="toggleLike('${d.id}', ${isLiked})" class="flex items-center text-xs ${isLiked ? 'text-red-500' : 'text-gray-400'}">
                            <svg class="w-4 h-4 mr-1" fill="${isLiked ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                            ${data.likes?.length || 0}
                        </button>
                    `;
                    list.appendChild(item);
                });
            });
        }

        window.toggleLike = async (id, isLiked) => {
            const ref = doc(db, `artifacts/${appId}/public/data/fortunes`, id);
            await updateDoc(ref, {
                likes: isLiked ? arrayRemove(currentUser) : arrayUnion(currentUser)
            });
        };
    </script>
</body>
</html>
